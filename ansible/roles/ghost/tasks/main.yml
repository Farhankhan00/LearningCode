- name: Ensure group {{ ghost_group }} exists
  group:
    name: "{{ ghost_group }}"
    state: present

- name: Add the user {{ ghost_user }} with a specific uid and a primary group of {{ ghost_group }}
  user:
    name: "{{ ghost_user }}"
    uid: "{{ ghost_uid }}"
    group: "{{ ghost_group }}" 

- name: create service directory  
  file: 
    state: directory
    path: "{{ service_dir }}"
    owner: "{{ ghost_user }}"
    group: "{{ ghost_group }}" 

- name: checkout ghost repo
  git:
    repo: https://github.com/TryGhost/Ghost.git
    dest: "{{ service_dir }}"
  become_user: "{{ ghost_user }}"

- name: Install packages based on package.json.
  npm:
    path: "{{ service_dir }}"
  become_user: "{{ ghost_user }}"

- name: Laydown ghost config
  template: 
    src: ghost-config.js.j2
    dest: "{{ service_dir }}/config.production.json" 
    owner: "{{ ghost_user }}"
    group: "{{ ghost_group }}" 