- name: Ensure group {{ ghost_group }} exists
  group:
    name: "{{ ghost_group }}"
    state: present

- name: Add the user {{ ghost_user }} with a specific uid and a primary group of {{ ghost_group }}
  user:
    name: "{{ ghost_user }}"
    uid: "{{ ghost_uid }}"
    group: "{{ ghost_group }}" 

- name: create services directory  
  file: 
    state: directory
    path: "{{ services_dir }}"
    owner: "{{ ghost_user }}"
    group: "{{ ghost_group }}" 

- name: checkout ghost repo
  git:
    repo: 'https://github.com/crielly/ghost.git'
    dest: "{{ services_dir }}/ghost"
  become_user: "{{ ghost_user }}"
  
- name: ghost config
  template: 
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: "{{ item.owner }}"
    group: "{{ item.group }}"
    mode: "{{ item.mode }}"
  with_items: "{{ ghost_configs }}"
  notify:
    - enable ghost
    - start ghost
    - restart ghost

